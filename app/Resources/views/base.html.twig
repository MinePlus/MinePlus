{#
    Note: The icon fonts are currently stored directly in the web/ directory,
    because I wasn't able to make assetic load them. This is also the reason
    why I disabled the 'cssrewrite' filter.
#}
{% import '::macros.html.twig' as macro %}
<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>{% block title %}{{ 'title'|trans }}{% endblock %}</title>
        {% block stylesheets %}
            {% stylesheets '@MinePlusMainBundle/Resources/public/css/*' %}
                <link rel="stylesheet" type="text/css" href="{{ asset_url }}" />
            {% endstylesheets %}
        {% endblock %}
        
        {# For context-specific styles #}
        <style type="text/css">
            {% block styles %}
                .navbar {
                    border-radius: 0;
                }
                .chat-log {
                    height: 85%;
                    overflow-y: scroll;
                }
                .chat-input {
                    padding: 10px;
                }
                .max-size {
                    max-width: 100%;
                    max-height: 100%;
                    width: 100%;
                    height: 100%;
                }
                .margin-top-little {
                    margin-top: 10px;
                }
                .margin-right-little {
                    margin-right: 10px;
                }
                .padding-left-little {
                    padding-left: 10px;
                }
                textarea {
                    resize: none;
                }
            {% endblock %}
        </style>
    </head>
    <body class="{% block body_class %}{% endblock %}">
        {% block body %}
            {% block navbar %}
                {{ knp_menu_render('MinePlusMainBundle:Builder:mainMenu', {}, 'main') }}
            {% endblock %}
            <div class="container">
                <div class="row">
                    <div class="col-md-10 col-md-offset-1">
                        {% block content %}
                        {% endblock %}
                    </div>
                </div>
            </div>
            {% block chat %}
                {% include '::modal/chat.html.twig' %}
            {% endblock %}
            {% block footer %}
                {# TODO: that's for the future ;) #}
            {% endblock %}
        {% endblock %}
        {% block javascripts %}
            {# I don't import just the entire js/ directory because the order
            is important here! #}
            {% javascripts 
                '@MinePlusMainBundle/Resources/public/js/jquery.min.js' 
                '@MinePlusMainBundle/Resources/public/js/bootstrap.min.js'
                '@JDareClankBundle/Resources/public/js/*'
                '@JDareClankBundle/Resources/public/js/vendor/*'
                '@MinePlusMainBundle/Resources/public/js/script.js' %}
                <script type="text/javascript" src="{{ asset_url }}"></script>
            {% endjavascripts %}
            <script type="text/javascript">
                $(document).ready(function() {
                    rescaleChat();
                    
                    var url = 'ws://{{ clank_host }}:{{ clank_port }}';
                    
                    var ws = Clank.connect(url);
                    
                    ws.on('socket/connect', function(session) {
                        setIndicator(true);
                        
                        session.subscribe('chat/channel/public', function(uri, payload) {
                            message(payload.msg);
                        });
                        
                        $('#chat-send').click(function () {
                            session.publish('chat/channel/public', {msg: $('#chat-textarea').val()});
                            $('#chat-textarea').val('');
                            $('#chat-send').addClass('disabled');
                        });
                    });
                    
                    ws.on('socket/disconnect', function(error) {
                        setIndicator(false);
                    });
                    
                    $('#chat-textarea').bind('input propertychange', function() {
                        if (this.value.length === 0) {
                            $('#chat-send').addClass('disabled');
                        } else {
                            if ($('#chat-send').hasClass('disabled')) {
                                $('#chat-send').removeClass('disabled');
                            }
                        }
                    });
                    
                });
            </script>
        {% endblock %}
    </body>
</html>
