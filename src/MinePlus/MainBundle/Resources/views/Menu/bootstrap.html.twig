{% import '::macros.html.twig' as macro %}

{% if inverse|default(false) == true %}
    {% set navbar_class = 'navbar-inverse' %}
{% endif %}

<nav class="navbar navbar-default {{ navbar_class|default }}" role="navigation">
    <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="{{ menu.uri }}">{{ menu.label }}</a>
    </div>
    
    <div class="collapse navbar-collapse navbar-exl-collapse">
        <ul class="nav navbar-nav">
            {% for item in menu %}
                <li {% if item.isCurrent %}class="active"{% endif %}>
                    <a href="{{ item.uri }}">
                        {% if item.getExtra('icon') != null %}
                            {{ macro.icon(item.getExtra('icon')) }}
                        {% endif %}
                        {{ item.label|trans }}
                    </a>
                </li>
            {% endfor %}
        </ul>
        
        {% if is_granted('ROLE_USER') %}
            {% if user_context|default(true) == true %}
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="{{ path('fos_message_inbox') }}">
                            {{ macro.icon('envelope') }}
                            {% if fos_message_nb_unread() != 0 %}
                                <span class="label label-warning">{{ fos_message_nb_unread() }}</span>
                            {% endif %}
                        </a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            {{ avatar(app.user.username, avatar_size|default(20))|raw }}
                            {{ app.user.username }}
                        </a>
                        <ul class="dropdown-menu">
                            {% block user_dropdown %}
                                <li>
                                    <a href="{{ path('fos_user_security_logout') }}">
                                        {{ macro.icon('log-out') }} {{ 'logout'|trans }}
                                    </a>
                                </li>
                            {% endblock %}
                        </ul>
                    </li>
                </ul>
            {% endif %}
        {% else %}
            {% if login_button|default(true) == true %}
                <a class="btn navbar-btn btn-default navbar-right" href="{{ path('fos_user_security_login') }}">
                    {{ 'login.login'|trans }}
                </a>
            {% endif %}
        {% endif %}
    </div>
</nav>